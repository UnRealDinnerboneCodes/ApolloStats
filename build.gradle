plugins {
    id 'com.github.johnrengelman.shadow' version '6.1.0'
    id 'java'
    id "maven-publish"
    id 'java-library'
}

group = 'com.unrealdinnerbone'
archivesBaseName = project.getProperty("name")

def ENV = System.getenv()
def buildNumber = ENV.GITHUB_RUN_NUMBER ? "${ENV.GITHUB_RUN_NUMBER}" : "0"
version = project.getProperty("version") + ("+build." + buildNumber).replace("\\", "")

java.toolchain.languageVersion = JavaLanguageVersion.of(17)

println("Project: " + archivesBaseName + "@" + version + " (Java" + java.toolchain.languageVersion.get().toString() + ")")

repositories {
    mavenCentral()
    maven { url "https://maven.unreal.codes/releases"}
}


configurations {
    shade
    implementation.extendsFrom shade
    shadow.extendsFrom shade
}

shadowJar {
    manifest {
        inheritFrom project.tasks.jar.manifest
    }
}


dependencies {
    shade 'com.unrealdinnerbone:UnRealLib:3.2.0+build.96'
    shade 'com.google.guava:guava:31.0.1-jre'
    shade('io.javalin:javalin:4.2.0')
    testImplementation 'junit:junit:4.13.2'
}

jar {
    manifest {
        attributes(
                'Main-Class': project.property("mainClass"),
                "Implementation-Version": version
        )
    }
}